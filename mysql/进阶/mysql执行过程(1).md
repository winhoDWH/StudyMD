## mysql执行组件

1. SQL接口：查询SQL请求调用SQL服务所需要的；

2. SQL解析器：相当于编译器，将SQL语句根据语法转换成`MYSQL`可执行的指令；

3. 查询优化器：将SQL语句的执行步骤进行最佳优化，如

   ```
   select r1, r2, r3 from user where r1 = 1;
   执行该sql语句的步骤有多种，如：
   第一种先找出r1=1的记录，再获取对应记录的r1,r2,r3字段的值返回；
   第二种先查出所有记录的r1,r2,r3的字段值，然后根据r1=1进行筛选；
   查询优化器的作用就是通过将SQL执行步骤进行排序优化，获取最佳最快的执行方式
   ```

4. 执行器：根据执行步骤调用`mysql`的存储引擎

5. 存储引擎：访问存储在内存与硬盘中的数据；



## InnoDB存储引擎的更新操作

1. 第一步（**提交事务前**）：`mysql`服务器内存中会有mysql的`缓冲池`，更新数据前需要如果对应数据不存在缓冲池中，则需要从硬盘中加载数据，**并对对应数据加上独占锁**
2. 第二步（**提交事务前**）：`undo日志`：将更新的新值写入到undo日志文件中，方便回滚数据的需要；
3. 第三步（**提交事务前**）：`更新缓冲池中的数据`，执行这步之后，由于**内存中的数据和磁盘中的数据并不一致**，所以内存中的新数据称为`脏数据`
4. 第四步（**提交事务前**）：`写redo log`；首先需要知道两个概念
   * `redo log日志`-->InnoDB存储引擎专有的记录数据修改操作的日志；
   * `Redo Log Buffer`-->是`redo log日志`在内存中的缓冲；
   * 写redo log日志是需要先写入`redo log buffer`，即内存中再更新到磁盘中的`redo log`文件里；
   * redo log将内存刷入磁盘的策略；通过配置`innodb_flush_log_at_trx_commit`的值确认；
     * `等于0`：提交事务时不会将日志刷入磁盘中，可能会导致丢失数据操作记录；
     * `等于1`：提交事务时必须将日志输入磁盘中，**只要事务提交成功，则磁盘中redo log一定刷新了**；
     * `等于2`：提交事务时，会将日志写入到`os cache`缓存（同样在内存中）中，随后某一时刻再写入；
     * 一般选择等于1的策略，确保操作记录不丢失；