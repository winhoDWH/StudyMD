### Elasticsearch基本概念和原理简介
#### 概述
1. 基于**Lucene**的搜索服务器，提供了分布式多用户能力的全文检索引擎，支持Restfulweb风格的url访问；基于**java开发**，一般用于检索；ES是分布式的，自动管理多个节点用来完成扩展和实现高可用性；
2. 不支持事务，只支持检索和存储；
#### 基本概念（名称）
##### 索引index：
   ES上的一个逻辑存储空间，相当于关系型数据库中的库；

##### 类型type：
索引index中可以存放多种对象，而类型则是**用来区分索引中不同的对象**，对应关系型数据库中表的概念；**ES7中被删除**，原因：
   1. 第一：ES不同于关系型数据库，在关系型数据库中，同一个数据库下不同表table1和table2如果定义相同的字段name，两表之间互不影响；**但在ES中，由于是基于Lucene开发的，不同type（对应关系数据库中的表）下同名的字段的处理方式是一样的，即被当做同一个字段，如果两个字段定义不相同，则会出现冲突的情况；**所以为了提高ES处理数据效率则去掉了type；
   2. 第二：同一索引下不同type下存储不同字段数的数据实体（可理解成存放不同结构的表）会导致存储中出现**稀疏数据**，影响Lucene压缩文档，导致ES查询效率低；

##### 文档document：
所有存储在ES中的数据实体就是文档，即关系数据库中的记录；每个文档有一个唯一标识ID

##### 映射mapping
对索引字段及其数据类型的定义就是映射，类似于关系数据库中的表结构；**不同于关系型数据库，ES会默认动态创建索引和索引类型的mapping**；

##### 节点：
1. 每一个ES进程就是一个ES节点，所以一个服务器上可以有多个ES节点，也可以将节点分配到不同服务器上；
2. ES节点启动后，会使用多播或者单播（看配置）寻找集群中其它节点并建立连接；
3. 节点种类：
   * client_node：其请求分发的作用；
   * master_node是主节点，所有增加、删出数据分片操作和搜索操作都由该节点执行；**ES底层没有更新数据操作，提供的更新操作实际上就是删除后新增**；
   * data_node：只做搜索操作；**client_node决定搜索请求分配到哪个data_node,data_node数据都由master_node同步过去**；

##### 分片shard:
ES自动将索引数据分成分片，然后存储在不同节点上；特点如下：
   1. ES的一个索引可以有多个分片；
   2. 一个文档只能完整的存放在一个分片上
   3. 每个分片是最小的工作单元，承载部分数据，兵器是一个lucene实例，有**完整的检索和处理请求的能力，即本身就是一个完整的搜索引擎**；
   4. 增减节点时，ES会自动进行负载均衡；
   5. 一个索引中含有分片shard的数量默认为5，**创建索引之后这个值不能被更改！**
   6. 每一个分片都有一个关联的副本分片（replica shard），其数量默认为1，这个**数量可以随时更改**；
   7. 有点：水平分割和扩展我们存放的内容索引；分发和并行跨碎片操作提高性能/吞吐量；

##### 副本replica:
shard的冗余备份，主要作用：
  1. 放置数据丢失
  2. shard异常时负责容错和负载均衡；

#### 索引原理
1. ES使用的是倒排索引；首先先了解一些概念；
2. Term单词： 一段文本，在被**文本分析器分析后会生成一组单词，这一个个的单词就是term**；
3. Term Dictionary单词字典：单词的集合，即一组Term；
4. Term Index单词索引：为了更好找到某个单词而组建的索引
5. Posting List倒排列表：该列表是列举出**存在某个单词的所有文档的文档ID以及该单词在文档中出现的位置信息等**，每一个单词对应一个列表（列表定义有文档ID、单词出现次数、在文档中的位置等信息），列表中每一条记录称为一个**倒排项**；
6. 倒排索引的过程，即根据**关键字找到对应文档的过程**：
   * 首先ES会为**单词**建立一个索引（使用B-Tree结构），然后**根据关键字找到单词Term**，再根据Term找到Posting List倒排列表并找到对应文档信息；


### elasticsearch-head
elasticsearch-head是一个界面化的集群操作和管理工具

### 参考：
1. https://blog.csdn.net/zhoushimiao1990/article/details/103226496 ES(一)：ES基本概念和原理简单介绍
2. https://blog.csdn.net/zhoushimiao1990 总目录
3. https://blog.csdn.net/zhenwei1994/article/details/94013059 ES基本介绍
4. https://blog.csdn.net/qq_40649503/article/details/109572150?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160508400519724835808708%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=160508400519724835808708&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v28-14-109572150.pc_search_result_cache&utm_term=springboot%E4%B8%AD%E6%9C%89%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E6%BA%90&spm=1018.2118.3001.4449